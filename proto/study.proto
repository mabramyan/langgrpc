syntax = "proto3";

package linguistglass;

option go_package = "github.com/mabramyan/langgrpc/go/linguistglass";

// StudyService handles flashcards and spaced repetition
service StudyService {
  // GetDailySession retrieves cards due for review today
  rpc GetDailySession (GetDailySessionRequest) returns (SessionResponse);
  // SubmitStudyResult submits a card review result
  rpc SubmitStudyResult (SubmitStudyResultRequest) returns (StudyResultResponse);
  // AddWordToFlashcards creates a new flashcard from a word
  rpc AddWordToFlashcards (AddWordToFlashcardsRequest) returns (CardResponse);
  // SyncProgress synchronizes study progress (offline support)
  rpc SyncProgress (SyncProgressRequest) returns (SyncProgressResponse);
  // GetStats retrieves user study statistics
  rpc GetStats (GetStatsRequest) returns (StatsResponse);
}

message GetDailySessionRequest {
  string user_id = 1;
  int32 limit = 2;
}

message SubmitStudyResultRequest {
  string card_id = 1;
  string user_id = 2;
  int32 quality = 3; // 0-5: 0-2=again, 3=hard, 4-5=easy
  bool context_bonus = 4; // Watched video context
  int64 timestamp = 5;
}

message AddWordToFlashcardsRequest {
  string user_id = 1;
  string word_id = 2;
  string dictionary_id = 3;
}

message SyncProgressRequest {
  string user_id = 1;
  repeated StudyLogEntry logs = 2;
}

message GetStatsRequest {
  string user_id = 1;
  int32 days = 2; // Number of days to retrieve
}

message Card {
  string id = 1;
  string user_id = 2;
  string dictionary_id = 3;
  string word_id = 4;
  string status = 5; // new, learning, review, mastered
  double ease_factor = 6;
  int32 interval = 7;
  int32 repetitions = 8;
  int64 next_review_at = 9;
}

message StudyLogEntry {
  string id = 1;
  string card_id = 2;
  int32 quality = 3;
  int64 timestamp = 4;
}

message DailyStats {
  string date = 1;
  int32 words_learned = 2;
  int32 time_spent_minutes = 3;
}

message SessionResponse {
  repeated Card cards = 1;
  int32 total_due = 2;
}

message StudyResultResponse {
  Card card = 1;
  int32 xp_earned = 2;
  bool leveled_up = 3;
}

message CardResponse {
  Card card = 1;
}

message SyncProgressResponse {
  bool success = 1;
  repeated string conflict_ids = 2; // Cards with conflicts
}

message StatsResponse {
  int32 current_streak = 1;
  int32 total_xp = 2;
  int32 words_learned = 3;
  int32 words_mastered = 4;
  repeated DailyStats daily_stats = 5;
}
